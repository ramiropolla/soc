Index: libavcodec/golomb.h
===================================================================
--- libavcodec/golomb.h	(revision 11230)
+++ libavcodec/golomb.h	(working copy)
@@ -504,4 +504,31 @@
     set_ur_golomb_jpegls(pb, v, k, limit, esc_len);
 }
 
+/**
+ * write unsigned interleaved exponential golomb code (Dirac)
+ */
+static inline void dirac_set_ue_golomb(PutBitContext *pb, int i)
+{
+    int log = av_log2(++i);
+    while(log) {
+        log--;
+        put_bits(pb, 1, 0);
+        put_bits(pb, 1, (i >> log)&1);
+    }
+    put_bits(pb, 1, 1);
+}
+
+/**
+ * write signed interleaved exponential golomb code (Dirac)
+ */
+static inline void dirac_set_se_golomb(PutBitContext *pb, int i)
+{
+    dirac_set_ue_golomb(pb, FFABS(i));
+    if (i > 0)
+        put_bits(pb, 1, 0);
+    else if (i < 0)
+        put_bits(pb, 1, 1);
+}
+
+
 #endif /* FFMPEG_GOLOMB_H */
Index: libavcodec/Makefile
===================================================================
--- libavcodec/Makefile	(revision 11230)
+++ libavcodec/Makefile	(working copy)
@@ -56,6 +56,8 @@
 OBJS-$(CONFIG_CSCD_DECODER)            += cscd.o
 OBJS-$(CONFIG_CYUV_DECODER)            += cyuv.o
 OBJS-$(CONFIG_DCA_DECODER)             += dca.o
+OBJS-$(CONFIG_DIRAC_DECODER)           += diracdec.o dirac.o dirac_arith.o dirac_wavelet.o golomb.o
+OBJS-$(CONFIG_DIRAC_ENCODER)           += diracenc.o dirac.o dirac_arith.o dirac_wavelet.o golomb.o
 OBJS-$(CONFIG_DNXHD_DECODER)           += dnxhddec.o dnxhddata.o
 OBJS-$(CONFIG_DNXHD_ENCODER)           += dnxhdenc.o dnxhddata.o mpegvideo_enc.o motion_est.o ratecontrol.o
 OBJS-$(CONFIG_DSICINVIDEO_DECODER)     += dsicinav.o
@@ -314,6 +316,7 @@
 OBJS-$(CONFIG_AC3_PARSER)              += ac3_parser.o ac3tab.o aac_ac3_parser.o
 OBJS-$(CONFIG_CAVSVIDEO_PARSER)        += cavs_parser.o
 OBJS-$(CONFIG_DCA_PARSER)              += dca_parser.o
+OBJS-$(CONFIG_DIRAC_PARSER)            += dirac_parser.o
 OBJS-$(CONFIG_DVBSUB_PARSER)           += dvbsub_parser.o
 OBJS-$(CONFIG_DVDSUB_PARSER)           += dvdsub_parser.o
 OBJS-$(CONFIG_H261_PARSER)             += h261_parser.o
Index: libavcodec/allcodecs.c
===================================================================
--- libavcodec/allcodecs.c	(revision 11230)
+++ libavcodec/allcodecs.c	(working copy)
@@ -73,6 +73,7 @@
     REGISTER_DECODER (CLJR, cljr);
     REGISTER_DECODER (CSCD, cscd);
     REGISTER_DECODER (CYUV, cyuv);
+    REGISTER_ENCDEC  (DIRAC, dirac);
     REGISTER_ENCDEC  (DNXHD, dnxhd);
     REGISTER_DECODER (DSICINVIDEO, dsicinvideo);
     REGISTER_ENCDEC  (DVVIDEO, dvvideo);
@@ -283,6 +284,7 @@
     REGISTER_PARSER  (AC3, ac3);
     REGISTER_PARSER  (CAVSVIDEO, cavsvideo);
     REGISTER_PARSER  (DCA, dca);
+    REGISTER_PARSER  (DIRAC, dirac);
     REGISTER_PARSER  (DVBSUB, dvbsub);
     REGISTER_PARSER  (DVDSUB, dvdsub);
     REGISTER_PARSER  (H261, h261);
Index: libavcodec/avcodec.h
===================================================================
--- libavcodec/avcodec.h	(revision 11230)
+++ libavcodec/avcodec.h	(working copy)
@@ -169,6 +169,7 @@
     CODEC_ID_VP6A,
     CODEC_ID_AMV,
     CODEC_ID_VB,
+    CODEC_ID_DIRAC,
 
     /* various PCM "codecs" */
     CODEC_ID_PCM_S16LE= 0x10000,
Index: libavformat/riff.c
===================================================================
--- libavformat/riff.c	(revision 11230)
+++ libavformat/riff.c	(working copy)
@@ -37,6 +37,7 @@
     { CODEC_ID_H263P, MKTAG('H', '2', '6', '3') },
     { CODEC_ID_H263I, MKTAG('I', '2', '6', '3') }, /* intel h263 */
     { CODEC_ID_H261, MKTAG('H', '2', '6', '1') },
+    { CODEC_ID_DIRAC, MKTAG('D', 'R', 'A', 'C') },
 
     /* added based on MPlayer */
     { CODEC_ID_H263P, MKTAG('U', '2', '6', '3') },
Index: libavformat/raw.c
===================================================================
--- libavformat/raw.c	(revision 11230)
+++ libavformat/raw.c	(working copy)
@@ -312,6 +312,7 @@
         av_set_pts_info(st, 64, ap->time_base.num, ap->time_base.den);
     } else if ( st->codec->codec_id == CODEC_ID_MJPEG ||
                 st->codec->codec_id == CODEC_ID_MPEG4 ||
+                st->codec->codec_id == CODEC_ID_DIRAC ||
                 st->codec->codec_id == CODEC_ID_H264) {
         av_set_pts_info(st, 64, 1, 25);
     }
@@ -404,6 +405,14 @@
     return 0;
 }
 
+static int dirac_probe(AVProbeData *p)
+{
+    if (AV_RL32(p->buf) == MKTAG('B', 'B', 'C', 'D'))
+        return AVPROBE_SCORE_MAX;
+    else
+        return 0;
+}
+
 static int ac3_probe(AVProbeData *p)
 {
     int max_frames, first_frames = 0, frames;
@@ -506,6 +515,33 @@
 };
 #endif //CONFIG_MUXERS
 
+AVInputFormat dirac_demuxer = {
+    "dirac",
+    "raw dirac",
+    0,
+    dirac_probe,
+    video_read_header,
+    raw_read_partial_packet,
+    raw_read_close,
+    .flags= AVFMT_GENERIC_INDEX,
+    .value = CODEC_ID_DIRAC,
+};
+
+#ifdef CONFIG_MUXERS
+AVOutputFormat dirac_muxer = {
+    "dirac",
+    "raw dirac",
+    NULL,
+    "dirac",
+    0,
+    0,
+    CODEC_ID_DIRAC,
+    NULL,
+    raw_write_packet,
+    .flags= AVFMT_NOTIMESTAMPS,
+};
+#endif
+
 AVInputFormat dts_demuxer = {
     "dts",
     "raw dts",
Index: libavformat/allformats.c
===================================================================
--- libavformat/allformats.c	(revision 11230)
+++ libavformat/allformats.c	(working copy)
@@ -67,6 +67,7 @@
     REGISTER_DEMUXER  (C93, c93);
     REGISTER_MUXER    (CRC, crc);
     REGISTER_DEMUXER  (DAUD, daud);
+    REGISTER_MUXDEMUX (DIRAC, dirac);
     REGISTER_DEMUXER  (DSICIN, dsicin);
     REGISTER_DEMUXER  (DTS, dts);
     REGISTER_MUXDEMUX (DV, dv);
