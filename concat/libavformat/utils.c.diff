diff --git a/libavformat/utils.c b/libavformat/utils.c
index b9f6c00..3b652a0 100644
--- a/libavformat/utils.c
+++ b/libavformat/utils.c
@@ -27,6 +27,7 @@
 #include <sys/time.h>
 #include <time.h>
 #include <strings.h>
+#include "concat.h"
 
 #undef NDEBUG
 #include <assert.h>
@@ -433,6 +434,7 @@ int av_open_input_file(AVFormatContext **ic_ptr, const char *filename,
                        AVFormatParameters *ap)
 {
     int err, probe_size;
+    PlaylistContext *playlist_ctx;
     AVProbeData probe_data, *pd = &probe_data;
     ByteIOContext *pb = NULL;
 
@@ -447,6 +449,27 @@ int av_open_input_file(AVFormatContext **ic_ptr, const char *filename,
         fmt = av_probe_input_format(pd, 0);
     }
 
+    playlist_ctx = ff_playlist_from_encodedstring(filename, ',');
+    if (playlist_ctx) {
+        AVFormatContext *ic;
+        AVFormatParameters default_ap;
+        if(!ap){
+            ap=&default_ap;
+            memset(ap, 0, sizeof(default_ap));
+        }
+        if(!ap->prealloced_context)
+            ic = *ic_ptr = avformat_alloc_context();
+        else
+            ic = *ic_ptr;
+        av_log(ic, AV_LOG_DEBUG, "Generating playlist from %s\n", filename);
+        av_strlcpy(ic->filename, filename, sizeof(ic->filename));
+        ic->iformat = ff_concat_alloc_demuxer();
+        ff_playlist_set_context(ic, playlist_ctx);
+        ff_playlist_populate_context(playlist_ctx, playlist_ctx->pe_curidx);
+        ff_playlist_set_streams(ic);
+        return 0;
+    }
+
     /* Do not open file if the format does not need it. XXX: specific
        hack needed to handle RTSP/TCP */
     if (!fmt || !(fmt->flags & AVFMT_NOFILE)) {
