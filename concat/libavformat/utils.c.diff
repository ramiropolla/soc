diff --git a/libavformat/utils.c b/libavformat/utils.c
index b9f6c00..7f03651 100644
--- a/libavformat/utils.c
+++ b/libavformat/utils.c
@@ -27,6 +27,7 @@
 #include <sys/time.h>
 #include <time.h>
 #include <strings.h>
+#include "playlist.h"
 
 #undef NDEBUG
 #include <assert.h>
@@ -432,7 +433,8 @@ int av_open_input_file(AVFormatContext **ic_ptr, const char *filename,
                        int buf_size,
                        AVFormatParameters *ap)
 {
-    int err, probe_size;
+    int err, probe_size, flist_len;
+    char **flist;
     AVProbeData probe_data, *pd = &probe_data;
     ByteIOContext *pb = NULL;
 
@@ -447,6 +449,22 @@ int av_open_input_file(AVFormatContext **ic_ptr, const char *filename,
         fmt = av_probe_input_format(pd, 0);
     }
 
+    av_playlist_split_encodedstring(filename, ',', &flist, &flist_len);
+    if (flist && flist_len > 1) {
+        AVFormatContext *ic = av_playlist_formatcontext_from_filelist(flist, flist_len);
+        if (ic) {
+            AVPlaylistContext *playlist_ctx = av_playlist_get_context(ic);
+            if (playlist_ctx) {
+                av_log(ic, AV_LOG_DEBUG, "Generating playlist from %s\n", filename);
+                av_strlcpy(ic->filename, filename, sizeof(ic->filename));
+                av_playlist_populate_context(playlist_ctx, playlist_ctx->pe_curidx);
+                av_playlist_set_streams(ic);
+                *ic_ptr = ic;
+                return 0;
+            }
+        }
+    }
+
     /* Do not open file if the format does not need it. XXX: specific
        hack needed to handle RTSP/TCP */
     if (!fmt || !(fmt->flags & AVFMT_NOFILE)) {
